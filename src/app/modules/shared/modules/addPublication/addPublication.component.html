<div class="publishing-container" *ngIf="user">
  <form [formGroup]="myForm" (ngSubmit)="onSave()" autocomplete="off">
    <div class="publishing-header">



      <worky-avatar *ngIf="type === typePublishing.POST || typePublishing.POSTPROFILE"
        [size]="60" 
        img="{{ profileImageUrl }}"
        name="{{ user.name}} {{ user.lastName }}">
      </worky-avatar>

      <div class="user-name-content" *ngIf="type !== typePublishing.COMMENT">
        <div>
          <span class="name"> {{ user.name }} {{ user.lastName }} </span>
          <span class="geoLocationName" *ngIf="nameGeoLocation !== ''"> está en <a [href]="dataGeoLocation" target="_blank">{{ nameGeoLocation }}</a></span> 
        </div>
        <div class="dropdown">
          <div class="form-select" [innerHTML]="privacyFront"
            data-bs-toggle="dropdown"
            aria-expanded="false">
          </div>
          <ul
            class="dropdown-menu "
            aria-labelledby="navbarDropdownMenuLink">
            <li>
              <div class="dropdown-item"
                (click)="postPrivacy(typePrivacy.PUBLIC)">
                <i class="material-icons">language</i> {{ 'publishing.privacy-public' | workyTranslations }}
              </div>
            </li>

            <li>
              <div class="dropdown-item"
                (click)="postPrivacy(typePrivacy.FRIENDS)">
                <i class="material-icons">group</i> {{ 'publishing.privacy-friends' | workyTranslations }}
              </div>
            </li>

            <li>
              <div class="dropdown-item"
                (click)="postPrivacy(typePrivacy.PRIVATE)">
                <i class="material-icons">lock</i> {{ 'publishing.privacy-private' | workyTranslations }}
              </div>
            </li>
          </ul>
        </div>
      </div>

    </div>

    <div class="publishing-body" [class.comment-body]="type === typePublishing.COMMENT">
      <div class="textarea-container">

        <worky-avatar [size]="35" *ngIf="type === typePublishing.COMMENT"></worky-avatar>

        <textarea #postText
          class="publishing-textarea"
          (input)="onTextareaInput()"
          formControlName="content"
          placeholder="{{ type === typePublishing.POST || typePublishing.POSTPROFILE ? ('publishing.placeholder' | workyTranslations) + ' ' + user.name + ' ' + user.lastName + '?' : ('publishing.placeholderComment' | workyTranslations) + user.name + ' ' + user.lastName + '?' }}">
        </textarea>


      </div>

      <div class="previews">
        <div *ngFor="let preview of previews; let i = index" class="preview">
          <img *ngIf="preview.type === 'image'" [src]="preview.url" alt="Image Preview">
          <video *ngIf="preview.type === 'video'" [src]="preview.url" controls></video>
          <i class="material-icons remove-button" (click)="removeFile(i)">close</i>
        </div>
      </div>


      <div class="extra-content">

        <div class="extra-content-item file-upload"
             matTooltip="Subir Imagen"
             (click)="openUploadModal()">
          <i class="material-icons">add_photo_alternate</i>

        </div>

        <div *ngIf="type === typePublishing.POST"
             class="extra-content-item location-on"
             matTooltip="Estoy Aquí"
             (click)="openLocationSearch()">
          <i class="material-icons">location_on</i>
        </div>

        <div class="extra-content-item emoji-icon" matTooltip="Agrega Emoji">
          <i class="material-icons" (click)="toggleEmojiMenu()">mood</i>
          <div *ngIf="showEmojiMenu" class="emoji-menu" (click)="preventClose($event)">
            <emoji-mart
              [darkMode]="false"
              [showPreview]="false"
              [enableSearch]="false"
              [perLine]="7"
              [emojiSize]="24"
              (emojiSelect)="onEmojiClick($event)">
            </emoji-mart>
          </div>
        </div>


      </div>

    </div>

    <div class="publishing-footer">
      <worky-buttons
        type="submit"
        [workyButtonType]="WorkyButtonType.Flat"
        [theme]="WorkyButtonTheme.Accent"
        [disabled]="!myForm.valid || !myForm.dirty"
        [width]="'100%'">
        <span basic-button-text>{{ type === typePublishing.POST ? ('publishing.publish' | workyTranslations) : ('publishing.comment' | workyTranslations) }}</span>
      </worky-buttons>
    </div>

  </form>
</div>
