<div class="statistics-dashboard">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-title">
        <h1 class="title">Dashboard de Estadísticas</h1>
        <p class="subtitle">Métricas en tiempo real de la plataforma</p>
      </div>
      <div class="header-actions">
        <button class="refresh-btn" (click)="refreshStatistics()" [disabled]="isLoading">
          <i class="material-icons" [class.rotating]="isLoading">refresh</i>
          <span class="btn-text">Actualizar</span>
        </button>
        <div class="last-updated">
          <i class="material-icons">schedule</i>
          <span>Última actualización: {{ lastUpdated | workyDate:'short' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-content">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
      </div>
      <div class="loading-text">
        <h3>Cargando métricas</h3>
        <p>Recopilando estadísticas en tiempo real...</p>
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <div class="error-container" *ngIf="error && !isLoading">
    <div class="error-content">
      <div class="error-icon">
        <i class="material-icons">error_outline</i>
      </div>
      <div class="error-text">
        <h3>Error al cargar métricas</h3>
        <p>{{ error }}</p>
        <button class="retry-btn" (click)="refreshStatistics()">
          <i class="material-icons">refresh</i>
          Reintentar
        </button>
      </div>
    </div>
  </div>

  <div class="statistics-grid" *ngIf="!isLoading && !error">
    <div class="stat-card primary">
      <div class="card-header">
        <div class="card-icon">
          <i class="material-icons">people</i>
        </div>
        <div class="card-info">
          <h3 class="card-title">Usuarios Registrados</h3>
          <p class="card-subtitle">Total de usuarios en la plataforma</p>
        </div>
      </div>
      <div class="card-content">
        <div class="main-stat" *ngIf="!isLoadingUsers; else usersLoading">
          <span class="stat-number">{{ allUsersLength | number }}</span>
          <span class="stat-label">usuarios</span>
        </div>
        <ng-template #usersLoading>
          <div class="main-stat loading">
            <div class="stat-skeleton"></div>
            <span class="stat-label">usuarios</span>
          </div>
        </ng-template>
        <div class="stat-details" *ngIf="!isLoadingUsers; else usersDetailsLoading">
          <div class="detail-item">
            <span class="detail-label">Activos:</span>
            <span class="detail-value">{{ activeUsersCount | number }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Pendientes:</span>
            <span class="detail-value">{{ pendingUsersCount | number }}</span>
          </div>
        </div>
        <ng-template #usersDetailsLoading>
          <div class="stat-details">
            <div class="detail-item">
              <span class="detail-label">Activos:</span>
              <div class="detail-skeleton"></div>
            </div>
            <div class="detail-item">
              <span class="detail-label">Pendientes:</span>
              <div class="detail-skeleton"></div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="stat-card success">
      <div class="card-header">
        <div class="card-icon">
          <i class="material-icons">article</i>
        </div>
        <div class="card-info">
          <h3 class="card-title">Publicaciones</h3>
          <p class="card-subtitle">Contenido generado por usuarios</p>
        </div>
      </div>
      <div class="card-content">
        <div class="main-stat" *ngIf="!isLoadingPublications; else publicationsLoading">
          <span class="stat-number">{{ countPublications | number }}</span>
          <span class="stat-label">publicaciones</span>
        </div>
        <ng-template #publicationsLoading>
          <div class="main-stat loading">
            <div class="stat-skeleton"></div>
            <span class="stat-label">publicaciones</span>
          </div>
        </ng-template>
        <div class="stat-details" *ngIf="!isLoadingPublications; else publicationsDetailsLoading">
          <div class="detail-item">
            <span class="detail-label">Con media:</span>
            <span class="detail-value">{{ publicationsWithMedia | number }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Hoy:</span>
            <span class="detail-value">{{ todayPublications | number }}</span>
          </div>
        </div>
        <ng-template #publicationsDetailsLoading>
          <div class="stat-details">
            <div class="detail-item">
              <span class="detail-label">Con media:</span>
              <div class="detail-skeleton"></div>
            </div>
            <div class="detail-item">
              <span class="detail-label">Hoy:</span>
              <div class="detail-skeleton"></div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="stat-card info">
      <div class="card-header">
        <div class="card-icon">
          <i class="material-icons">chat_bubble</i>
        </div>
        <div class="card-info">
          <h3 class="card-title">Comentarios</h3>
          <p class="card-subtitle">Interacciones en publicaciones</p>
        </div>
      </div>
      <div class="card-content">
        <div class="main-stat" *ngIf="!isLoadingComments; else commentsLoading">
          <span class="stat-number">{{ totalComments | number }}</span>
          <span class="stat-label">comentarios</span>
        </div>
        <ng-template #commentsLoading>
          <div class="main-stat loading">
            <div class="stat-skeleton"></div>
            <span class="stat-label">comentarios</span>
          </div>
        </ng-template>
        <div class="stat-details" *ngIf="!isLoadingComments; else commentsDetailsLoading">
          <div class="detail-item">
            <span class="detail-label">Promedio por pub:</span>
            <span class="detail-value">{{ avgCommentsPerPublication | number:'1.1-1' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Hoy:</span>
            <span class="detail-value">{{ todayComments | number }}</span>
          </div>
        </div>
        <ng-template #commentsDetailsLoading>
          <div class="stat-details">
            <div class="detail-item">
              <span class="detail-label">Promedio por pub:</span>
              <div class="detail-skeleton"></div>
            </div>
            <div class="detail-item">
              <span class="detail-label">Hoy:</span>
              <div class="detail-skeleton"></div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="stat-card warning">
      <div class="card-header">
        <div class="card-icon">
          <i class="material-icons">favorite</i>
        </div>
        <div class="card-info">
          <h3 class="card-title">Reacciones</h3>
          <p class="card-subtitle">Engagement de usuarios</p>
        </div>
      </div>
      <div class="card-content">
        <div class="main-stat" *ngIf="!isLoadingReactions; else reactionsLoading">
          <span class="stat-number">{{ totalReactions | number }}</span>
          <span class="stat-label">reacciones</span>
        </div>
        <ng-template #reactionsLoading>
          <div class="main-stat loading">
            <div class="stat-skeleton"></div>
            <span class="stat-label">reacciones</span>
          </div>
        </ng-template>
        <div class="stat-details" *ngIf="!isLoadingReactions; else reactionsDetailsLoading">
          <div class="detail-item">
            <span class="detail-label">Promedio por pub:</span>
            <span class="detail-value">{{ avgReactionsPerPublication | number:'1.1-1' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Hoy:</span>
            <span class="detail-value">{{ todayReactions | number }}</span>
          </div>
        </div>
        <ng-template #reactionsDetailsLoading>
          <div class="stat-details">
            <div class="detail-item">
              <span class="detail-label">Promedio por pub:</span>
              <div class="detail-skeleton"></div>
            </div>
            <div class="detail-item">
              <span class="detail-label">Hoy:</span>
              <div class="detail-skeleton"></div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="stat-card danger">
      <div class="card-header">
        <div class="card-icon">
          <i class="material-icons">flag</i>
        </div>
        <div class="card-info">
          <h3 class="card-title">Reportes</h3>
          <p class="card-subtitle">Contenido reportado por usuarios</p>
        </div>
      </div>
      <div class="card-content">
        <div class="main-stat" *ngIf="!isLoadingReports; else reportsLoading">
          <span class="stat-number">{{ ReportsStatusPendingCount | number }}</span>
          <span class="stat-label">pendientes</span>
        </div>
        <ng-template #reportsLoading>
          <div class="main-stat loading">
            <div class="stat-skeleton"></div>
            <span class="stat-label">pendientes</span>
          </div>
        </ng-template>
        <div class="stat-details" *ngIf="!isLoadingReports; else reportsDetailsLoading">
          <div class="detail-item">
            <span class="detail-label">Resueltos:</span>
            <span class="detail-value">{{ resolvedReports | number }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Hoy:</span>
            <span class="detail-value">{{ todayReports | number }}</span>
          </div>
        </div>
        <ng-template #reportsDetailsLoading>
          <div class="stat-details">
            <div class="detail-item">
              <span class="detail-label">Resueltos:</span>
              <div class="detail-skeleton"></div>
            </div>
            <div class="detail-item">
              <span class="detail-label">Hoy:</span>
              <div class="detail-skeleton"></div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="stat-card secondary">
      <div class="card-header">
        <div class="card-icon">
          <i class="material-icons">email</i>
        </div>
        <div class="card-info">
          <h3 class="card-title">Mensajes</h3>
          <p class="card-subtitle">Comunicación entre usuarios</p>
        </div>
      </div>
      <div class="card-content">
        <div class="main-stat" *ngIf="!isLoadingMessages; else messagesLoading">
          <span class="stat-number">{{ totalMessages | number }}</span>
          <span class="stat-label">mensajes</span>
        </div>
        <ng-template #messagesLoading>
          <div class="main-stat loading">
            <div class="stat-skeleton"></div>
            <span class="stat-label">mensajes</span>
          </div>
        </ng-template>
        <div class="stat-details" *ngIf="!isLoadingMessages; else messagesDetailsLoading">
          <div class="detail-item">
            <span class="detail-label">No leídos:</span>
            <span class="detail-value">{{ unreadMessages | number }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Conversaciones:</span>
            <span class="detail-value">{{ activeConversations | number }}</span>
          </div>
        </div>
        <ng-template #messagesDetailsLoading>
          <div class="stat-details">
            <div class="detail-item">
              <span class="detail-label">No leídos:</span>
              <div class="detail-skeleton"></div>
            </div>
            <div class="detail-item">
              <span class="detail-label">Conversaciones:</span>
              <div class="detail-skeleton"></div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Additional Metrics Section -->
  <div class="additional-metrics" *ngIf="!isLoading">
    <h2 class="section-title">Métricas Adicionales</h2>
    
    <div class="metrics-grid">
      <!-- Engagement Rate -->
      <div class="metric-card">
        <div class="metric-header">
          <i class="material-icons metric-icon">trending_up</i>
          <h4>Tasa de Engagement</h4>
        </div>
        <div class="metric-value">
          <span class="percentage">{{ engagementRate | number:'1.1-1' }}%</span>
        </div>
        <div class="metric-description">
          Porcentaje de usuarios activos que interactúan con el contenido
        </div>
      </div>

      <!-- Content Growth -->
      <div class="metric-card">
        <div class="metric-header">
          <i class="material-icons metric-icon">arrow_upward</i>
          <h4>Crecimiento de Contenido</h4>
        </div>
        <div class="metric-value">
          <span class="percentage">{{ contentGrowthRate | number:'1.1-1' }}%</span>
        </div>
        <div class="metric-description">
          Incremento de publicaciones en los últimos 7 días
        </div>
      </div>

      <!-- User Activity -->
      <div class="metric-card">
        <div class="metric-header">
          <i class="material-icons metric-icon">access_time</i>
          <h4>Actividad de Usuarios</h4>
        </div>
        <div class="metric-value">
          <span class="percentage">{{ userActivityRate | number:'1.1-1' }}%</span>
        </div>
        <div class="metric-description">
          Usuarios que han interactuado en las últimas 24 horas
        </div>
      </div>

      <!-- Response Time -->
      <div class="metric-card">
        <div class="metric-header">
          <i class="material-icons metric-icon">timer</i>
          <h4>Tiempo de Respuesta</h4>
        </div>
        <div class="metric-value">
          <span class="time">{{ avgResponseTime | number:'1.0-0' }}h</span>
        </div>
        <div class="metric-description">
          Tiempo promedio de respuesta a reportes
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error">
    <div class="error-content">
      <i class="material-icons error-icon">warning</i>
      <h3>Error al cargar estadísticas</h3>
      <p>{{ error }}</p>
      <button class="refresh-btn primary" (click)="refreshStatistics()">
        <i class="material-icons">refresh</i>
        <span>Intentar de nuevo</span>
      </button>
    </div>
  </div>
</div>

